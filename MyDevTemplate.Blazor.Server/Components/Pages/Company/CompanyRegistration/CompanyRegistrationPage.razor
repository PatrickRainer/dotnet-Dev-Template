@using MyDevTemplate.Blazor.Server.Infrastructure
@using MyDevTemplate.Blazor.Server.Ressources
@attribute [Route(UrlProvider.CompanyRegistrationPage)]
@attribute [Route(UrlProvider.CompanyRegistrationPage + "/{SubscriptionId}")]

<PageTitle>Company Registration</PageTitle>

<AuthorizeView>
    <NotAuthorized>
        <MudPaper>
            <MudText>Please login or create an user account upfront:
                <MudLink Href="MicrosoftIdentity/Account/SignIn">Sign in</MudLink>
            </MudText>
        </MudPaper>
    </NotAuthorized>
    <Authorized>
        @if (SelectedSubscription != null)
        {
            <MudText Typo="Typo.h6">Your Subscription Model: @SelectedSubscription.Name</MudText>
            <MudText Typo="Typo.body2">@SelectedSubscription.Description</MudText>
            <MudChipSet T="string">
                @foreach (var feature in SelectedSubscription.Features)
                {
                    <MudChip T="string" Text="@feature" Color="Color.Info" Variant="Variant.Text" />
                }
            </MudChipSet>
        }
        <MudForm Model="@Model" @ref="_form" @bind-IsValid="@_isFormValid" @bind-Errors="@_errors"
                 Validation="@ModelValidator.ValidateValue" ValidationDelay="0">
            <MudTextField T="string" Label="Chosen Subscription"
                          For="@(() => Model.ChosenSubscription)"
                          ReadOnly="true"
                          @bind-Value="Model.ChosenSubscription"/>
            <MudTextField T="string" Label="@Blazor_Server_Localization.common_CompanyName"
                          For="@(() => Model.CompanyName)"
                          Immediate="true"
                          @bind-Value="Model.CompanyName"/>
            <MudTextField T="string" Label="@Blazor_Server_Localization.common_Street"
                          For="@(() => Model.Street)"
                          Immediate="true"
                          @bind-Value="Model.Street"/>
            <MudTextField T="string" Label="@Blazor_Server_Localization.common_City"
                          For="@(() => Model.City)"
                          Immediate="true"
                          @bind-Value="Model.City"/>
            <MudTextField T="string" Label="@Blazor_Server_Localization.common_Country"
                          For="@(() => Model.Country)"
                          Immediate="true"
                          @bind-Value="Model.Country"/>
            <MudTextField T="string" Label="@Blazor_Server_Localization.common_ZipCode"
                          For="@(() => Model.ZipCode)"
                          Immediate="true"
                          @bind-Value="Model.ZipCode"/>
        </MudForm>
        <MudButton color="Color.Primary" variant="Variant.Filled"
                   @onclick="@(async () => await Register(Model))">
            @Blazor_Server_Localization.common_Register
        </MudButton>
    </Authorized>
</AuthorizeView>

